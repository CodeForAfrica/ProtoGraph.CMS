function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(t){JCropInstance&&(JCropInstance.destroy(),$("#cropbox").attr("src",""),$("#cropbox").attr("style","")),$(".protograph-new-image").css("display","block"),$("#image_name").val(e.files[0].name.replace(/\.[^\/.]+$/,"")),$("#cropbox").attr("src",t.target.result),$("#cropbox").Jcrop({setSelect:[0,0,420,420],onSelect:update,onChange:update,boxHeight:350,boxWidth:500,aspectRatio:$("#aspectRatioMenu li.item.active").data().width/$("#aspectRatioMenu li.item.active").data().height},function(){JCropInstance=this})},t.readAsDataURL(e.files[0])}else $("#cropbox").attr("src",""),$("#image_name").val("")}function update(e){$(".jcrop-holder .protograph-crop-tooltip").length||$(".jcrop-holder").append('<div class="protograph-crop-tooltip"></div>'),$("#image_crop_x").val(e.x),$("#image_crop_y").val(e.y),$("#image_crop_w").val(e.w),$("#image_crop_h").val(e.h),$("#new_image_submit_button").hasClass("protograph-disabled-button")&&$("#new_image_submit_button").removeClass("protograph-disabled-button");var t="",a=Math.round(e.w),o=Math.round(e.h),i=a/gcd(a,o),r=o/gcd(a,o);e.w>0&&e.h>0?(t+=a+" x "+o,t+="  ",t+="("+Math.round(i)+":"+Math.round(r)+")"):t+=a+" x "+o,$(".protograph-crop-tooltip").html(t)}var gcd=function(e,t){return t?gcd(t,e%t):e};$(document).ready(function(){$("#aspectRatioMenu li.item").on("click",function(e){if("disabled"===$(this).attr("disabled"))return!1;var t,a,o=$(this);o.addClass("active").siblings(".item").removeClass("active"),t=o.data(),a=t.height>0&&t.width>0?t.width/t.height:0,$("#cropbox").Jcrop({setSelect:[0,0,420,420],onSelect:update,onChange:update,boxHeight:350,boxWidth:500,aspectRatio:a},function(){JCropInstance=this}),e.preventDefault()}),$("#new_image").submit(function(){return $("#ui_dimmer").addClass("active"),!0}),$("#new_image").on("ajax:success",function(e){var t=e.detail[0];$("#image_url_container").css("display","block"),$("#photo_url").val(t.data.image_url),$("#photo_url").focus(),$("#photo_url").select(),$("#ui_dimmer").removeClass("active")}).on("ajax:error",function(e){var t=e.detail[0];showAllValidationErrors(t.errors),$("#ui_dimmer").removeClass("active"),$("#image_url_container").css("display","block")}),$("#protograph_image_bank_button").on("click",function(){$("#new_image")[0].reset(),$("#image_url_container").css("display","none"),JCropInstance&&JCropInstance.destroy(),$("#aspectRatioMenu li.item.active").removeClass("active"),$("#aspectRatioMenu li.item:first").addClass("active"),$("#image_container").css("display","none")})});