<%= stylesheet_link_tag "justified.css" %>

<style type="text/css">
  .photo-container:hover .photograph-image-details {
    display: block;
  }
  .photograph-image-details {
    display: none;
    position: absolute;
    bottom: 0px;
    padding-left: 10px;
    background: rgba(0,0,0,0.65);
    color: white;
    width: 100%;
  }
</style>

<div class="sixteen wide column">

  <h1 class="ui header">Digital Asset Manager</h1>
  <button class="ui right floated button" id="openFileUpload"> Add a new image </button>

  <div style="clear: both;"></div>
  <br>
  <div id="imageContainer"></div>

  <div class="ui modal" id="fileUploadModal"> <i class="close icon"></i>
      <div class="header">Add a new image</div>
      <div class="content">
        <%= simple_form_for([@account, @image]) do |f| %>
          <%= f.error_notification %>
          <%= f.input :image, as: :file, required: true %>
          <div class="form-inputs">
            <%= f.input :account_id, as: :hidden, input_html: {value: @account.id} %>
            <%= f.input :name, required: true %>
            <%= f.input :tags %>
            <%= f.input :description %>
          </div>
        <% end %>
      </div>
      <div class="actions">
        <input type="submit" value="submit" form="new_image" class="ui button">
      </div>
  </div>

</div>
<%= javascript_include_tag "justified.js" %>

<script type="text/javascript">
  var images = <%= @images.to_json.html_safe %>;

  $(document).ready(function() {
    $('#openFileUpload').on('click', function () {
      $('#fileUploadModal').modal('show');
    });
    var maxHeight = 150;
    $('#imageContainer').empty().justifiedImages({
      images : images,
      rowHeight: maxHeight,
      maxRowHeight: maxHeight,
      thumbnailPath: function(photo, width, height){
        return photo.thumbnail_url;
      },
      getSize: function(photo){
        return {width: photo.thumbnail_width, height: photo.thumbnail_height};
      },
      template: function (photo) {
        var image = '<div class="photo-container" style="height:'+maxHeight+'px;margin-right:'+photo.marginRight+'px;">'
        image += '<img class="image-thumb" src="' + photo.src + '" style="width: '+photo.displayWidth+'px; height: '+photo.displayHeight+'px; margin-top: -8.0235px;">';
        image += '<div class="photograph-image-details">' +photo.displayWidth+ ' x ' +photo.displayHeight+ '</div>'
        image += '</div>';
        return image;
      },
      margin: 5
    });


  });
</script>