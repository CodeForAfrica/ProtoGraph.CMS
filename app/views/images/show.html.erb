<% w = @image.image_width %>
<% h = @image.image_height %>

<div class="ui mini breadcrumb">
  <%=link_to @account.username, @account, class: "section", "data-turbolinks"=> false %>
  <i class="right angle icon divider"></i>
  <%=link_to "Image Bank", account_images_path(@account), class: "section", "data-turbolinks"=> false %>
</div>
<div class="two-br-space"></div>
<div class="sixteen wide column" style="max-height: 600px; overflow: auto;" >



  <div class="row">
        <div class="left floated three wide column">
          <span class='ui huge header'><%= @image.name %></span>
        </div>
        <div class="right floated four wide column right aligned">
          <a id="openFileUpload" class='ui primary basic button mini'>Crop original image to create variation</a>
        </div>
    </div>



  <h3 class="ui header protograph-image-form-heading">Original Image</h3>
  <div class="ui fluid image" style="background: #efefef;">
    <a class="ui right corner label" id="copyToClipboard" data-clipboard-text="<%= @image.original_image.image_url %>" data-content="Copied">
      <i class="copy icon"></i>
    </a>
    <img class="ui centered image" src="<%= @image.original_image.image_url %>" style="height: 350px; width: initial !important;">
    <div class="photograph-image-details" style="display: block;"><%= "#{w} x #{h} (#{w / w.gcd(h)} : #{h / w.gcd(h)})"%></div>
  </div>
</div>
<div class="one-br-space"></div>
<div class="sixteen wide column">
  <div style="position: relative;">
    <% if @image.image_variation.present? %>
      <h3 class="ui header protograph-image-form-heading">Variations</h3>
    <% end %>
  </div>
  <% if @image.image_variation.present? %>
    <div id="variationImages"></div>
  <% end %>

</div>

<script type="text/javascript">
  <% if @image.image_variation.present? %>
    var images = <%= @image.image_variation.as_json.to_json.html_safe %>;
  <% end %>

  $(document).ready(function(){

    $('#openFileUpload').on('click', function () {
      $('#imageCropperModal').modal('show');
    });

    <% if @image.image_variation.present? %>
      var maxHeight = 75;
      $('#variationImages').empty().justifiedImages({
        images : images,
        rowHeight: maxHeight,
        maxRowHeight: 75,
        thumbnailPath: function(photo, width, height){
          return photo.image_url;
        },
        getSize: function(photo){
          return {width: photo.image_width, height: photo.image_height};
        },
        template: function (data) {
          var image;

          image = '<div class="photo-container" style="height:' + data.displayHeight + 'px;margin-right:' + data.marginRight + 'px;">';
          image +=    '<a class="ui right corner label protograph-popup-trigger" data-clipboard-text="'+data.image_url+'" data-content="Copied" >';
          image +=      '<i class="copy icon"></i>'
          image +=    '</a>';
          image +=    '<img class="image-thumb" src="' + data.src + '" style="width:' + data.displayWidth + 'px;height:' + data.displayHeight + 'px;" >';
          image += '   <div class="photograph-image-details" style="display: block;">' + data.image_width + ' x ' + data.image_height + ' (' + data.aspectWidth + ':' + data.aspectHeight + ') ' + '</div>';
          image += '</div>';

          return image;
        },
        margin: 20,
        afterRenderCallback: function() {
          new Clipboard('.protograph-popup-trigger', {
            target: function(trigger) {
              return trigger;
            }
          });

          $('.protograph-popup-trigger').popup({
            on: 'click',
            position: 'top center',
            onVisible: function (e) {
              setTimeout(function() {
                $(e).popup('hide');
              }, 250);
            }
          });
        }
      });
    <% end %>


    new Clipboard('#copyToClipboard', {
      target: function(trigger) {
        return trigger;
      }
    });

    $('#copyToClipboard').popup({
      on: 'click',
      position: 'top center',
      onVisible: function (e) {
        setTimeout(function() {
          $(e).popup('hide');
        }, 250);
      }
    });
  })
</script>
<div class="ui large modal" id="imageCropperModal"> <i class="close icon"></i>
  <%= render partial: "images/cropper", locals: {mode: nil} %>
</div>
<%= render partial: "images/cropper_js" %>
