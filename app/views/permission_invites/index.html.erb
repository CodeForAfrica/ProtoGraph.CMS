<div class="row">
    <div class="col-sm-6" style="padding: 0px; margin-left: auto; margin-right: auto;">
        <h1><span style="font-weight: 200;">Site Categories:</span> <%= @site.domain %></h1>
        <br/>
        <h3>People</h3>
        <hr/>
        <span style="text-align: right;float: right" class="hint">
            <span id='invite_members'><a href='#' data-toggle='modal' data-target='#platform_modal'>Invite people</a></span>
        </span>
        <div style="margin-left: 0px;">
            <table class="table table-hover">
                <tbody>
                    <% @permissions.each do |permission| %>
                        <tr>
                            <td style="width: 10%; border: 0px;"><img class="rounded" src=<%=avatar_url(permission.user.email)%>>
                            </td>
                            <td style="border: 0px;">
                                <%= permission.user.name %>
                                    <% if permission.status == "Deactivated" %>
                                        <i style="font-weight: 200; color: gray;">(Deactivated)</i>
                                    <% end %>
                                    <br/>
                                    <div class="hint">
                                        <%= permission.user.email %>
                                    </div>
                                    <% if permission.user.current_sign_in_at.present? %>
                                        <div class="hint">
                                            Last seen
                                            <%= time_ago_in_words(permission.user.current_sign_in_at) %> ago.
                                        </div>
                                    <% end %>
                            </td>
                            <td style="border: 0px;">
                                <%= simple_form_for(permission, url: change_role_account_site_permission_path(@account, @site, permission), class: "permission_forms", method: :put) do |f| %>
                                    <%= f.hidden_field :updated_by, value: current_user.id %>
                                    <%= f.hidden_field :redirect_url, value: account_site_permission_invites_path(@account, @site) %>
                                    <%= f.input :ref_role_slug, collection: @permission_roles, include_blank: false, label: false, input_html: {class: "permission_select"}, label: "Role" %>
                                <% end %>
                            </td>
                            <td style="border: 0px;">
                                <% if current_user.id != permission.user_id and permission.status != "Deactivated" %>
                                    <%= link_to "x", account_permission_path(@account,   permission, redirect_url: account_site_permission_invites_path(@account, @site)), method: :delete, data: { confirm: 'Are you sure?' } %>
                                <% end %>
                            </td>
                        </tr>
                    <% end %>
                    <%= paginate @permissions %>
                </tbody>
            </table>
            <% if @pending_invites_count != 0 %>
                <br/>
                <h3>Pending Invites</h3>
                <hr/>
                <table class="table">
                    <tbody>
                        <% @permission_invites.each do |permission_invite| %>
                            <tr>
                                <td style="width: 10%; border: 0px;"><img class="rounded" src=<%=avatar_url(permission_invite.email)%>>
                                </td>
                                <td style="border: 0px;">
                                    <%= permission_invite.email %>
                                        <div class="hint">Invited by
                                            <%= permission_invite.creator.name %>
                                                <%= time_ago_in_words (permission_invite.created_at) %>.
                                        </div>
                                </td>
                                <td style="border: 0px;">
                                    <%= link_to "Remove".html_safe, account_permission_invite_path(@account, permission_invite,redirect_url: account_site_permission_invites_path(@account, @site)), method: :delete, data: { confirm: 'Are you sure?' } %>
                                </td>
                            </tr>
                        <% end %>
                    </tbody>
                </table>
            <% end %>
        </div>
    </div>
</div>


<div class="modal" id='platform_modal'>
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class='modal-title'>Invite members</div>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="image content">
                    <%= simple_form_for [@account, @permission_invite] do |f| %>
                        <% if @permission_invite.errors.any? %>
                            <div id="error_explanation" class="ui error message">
                                <div class="header">
                                    <%= pluralize(@permission_invite.errors.count, "error") %> prohibited this permission_invite from being saved:
                                </div>
                                <% @permission_invite.errors.full_messages.each do |message| %>
                                    <p>
                                        <%= message %>
                                    </p>
                                <% end %>
                            </div>
                        <% end %>
                        <%= f.hidden_field :permissible_type, value: "Site" %>
                        <%= f.hidden_field :permissible_id, value: @site.id %>
                        <%= f.hidden_field :created_by, value: current_user.id %>
                        <%= f.hidden_field :updated_by, value: current_user.id %>
                        <%= f.input :email, id: :permission_invite_email, required: true, autofocus: true %>
                        <%= f.hidden_field :redirect_url, value: account_site_permission_invites_path(@account, @site) %>
                        <%= f.input :ref_role_slug, collection: @permission_roles, include_blank: false, label: "Role" %>
                        <%= f.submit "Invite", class: "btn btn-light" %>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).on("turbolinks:load", function(){
        $(".permission_select").on("change", function(){
            $(this).parents('form').submit();
        });
    });
</script>

<% if @show_modal.present? and @show_modal %>
  <script type="text/javascript">
    $('#platform_modal').modal("show");
  </script>
<% end %>