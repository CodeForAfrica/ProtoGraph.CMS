<%= render partial: "stories/stories_header" %>
<br/>
<br/>
<br/>
<div class="row">
    <div class="col-sm-13">
        <div style="margin-left: auto; margin-right: auto; width: 540px;">
            
            <%= simple_form_for(@page, url: account_site_page_path(@account, @site), method: :put) do |f| %>
                <%= f.error_notification %>
                <div class="form-inputs">
                    
                    

                    <% if @page.cover_image_id.blank? %>
                        <%= f.fields_for :cover_image do |cover_image| %>
                            <%= cover_image.input :image, label: false, placeholder: "Upload cover image", input_html: {style: "width: 100%; background: lightgray; min-height: 200px; cursor: pointer; padding: 100px 0px;", onchange: "readURL(this);"}%>
                            <%= cover_image.hidden_field :account_id, value: @account.id %>
                            <%= cover_image.hidden_field :is_cover, value: true %>
                            <%= cover_image.hidden_field :created_by, value: current_user.id %>
                            <%= cover_image.hidden_field :updated_by, value: current_user.id %>
                        <% end %>
                    <% else %>
                        <%= image_tag(@page.cover_image_url,style: 'width: 100%', class: "img-fluid") %>
                        <br/>
                        <%= link_to "Remove", remove_cover_image_account_site_page_path(@account, @site, @page), method: :put%>
                        <br/>
                    <% end %>
                    <%= f.input :publish, as: :boolean, label: "&nbsp; Publish Page?".html_safe, hint: "Until you want the Story Card to be published live on your site, do not mark the article as published." %>
                    <div class="form-actions">
                      <% if @page.status == 'draft' %>
                        <%= f.button :submit, "Save as draft" %>
                      <% end %>
                      <%= f.button :submit, "Update" %>
                      <% if @page.status != 'draft' %>
                        &nbsp;&nbsp;|&nbsp;&nbsp;
                        <%= link_to "Preview", @page.html_url, target: "_blank" %>
                      <% end %>
                    </div>
                </div>
            <% end %>
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            
            <%= simple_form_for(@page, url: account_site_page_path(@account, @site), method: :put) do |f| %>
                <%= f.error_notification %>
                <div class="form-inputs">
                    <h3>Package the story</h3>
                    <br/>
                    <%= f.input :headline, required: true, minlength: 10 , maxlength: 90, hint: "Minimum length: 50 chars. Maximum length: 90 chars.", placeholder: "Title", label: "Headline", autofocus: true %>
                    <% if !@site.is_english or 1 == 1 %>
                        <%= f.input :english_headline, required: true, minlength: 10 , maxlength: 90, hint: "This is used for url management.", label: "Write the headline in English" %>
                    <% end %>
                    <%= f.input :summary, minlength: 50 , maxlength: 220, hint: "Minimum length: 50 chars. Maximum length: 200 chars." %>
                    <%= f.input :published_at, as: :datetime %>
                    <hr/>
                    <h3>Cover Image</h3>
                    <br/>
                    <%= f.input :cover_image_alignment, collection: @cover_image_alignment, selected: "horizontal", required: true %>
                    <%= f.input :publish, as: :boolean, label: "&nbsp; Publish Page?".html_safe, hint: "Until you want the Story Card to be published live on your site, do not mark the article as published." %>
                    <% if @page.view_cast_id.present? %>
                        <b>toStoryCard</b>
                        <div id="protoCard"></div>
                    <% end %>
                    <hr/>
                    <h3>Distribution</h3>
                    <br/>
                    <%= f.input :share_text_facebook %>
                    <%= f.input :share_text_twitter %>
                    <%= f.input :meta_keywords %>
                    <%= f.input :meta_description %>
                </div>
                <div class="form-actions">
                  <%= f.button :submit, "Save" %>
                  <% if @page.status != 'draft' %>
                    &nbsp;&nbsp;|&nbsp;&nbsp;
                    <%= link_to "Preview", @page.html_url, target: "_blank" %>
                  <% end %>
                </div>
            <% end %>
        </div>
    </div>
	<div class="col-sm-3 help-text">
        <%= render partial: "stories/stories_sidebar" %>
		<!--<%= image_tag "help.png", style: "float: right; right: 0; top: 0; position: relative;" %><h2>Email Settings</h2>
		<p>Your default support email address is prototype@pro.to. Any email sent here gets automatically converted into a ticket that you can get working on.</p>
		<p>You can configure your Freshdesk account to use a support email in your own domain, like <a href="">support@mycompany.com</a> by forwarding emails from this address to <a href="">protoprototype@heyproto.freshdesk.com</a>. To create a new support email box, click “Edit” under global email settings.</p>-->
	</div>
</div>



<% if @view_cast.present? %>
  <script src="https://cdn.protograph.pykih.com/lib/protoGraph.min.js" async></script>
  <script>
      var interval = setInterval(function () {
          if (window.ProtoEmbed) {
              clearInterval(interval);
              var proto_embed_test = new ProtoEmbed.initFrame(document.getElementById('protoCard'), "<%= "#{@view_cast.template_card.index_html }?view_cast_id=#{ @view_cast.datacast_identifier }%26schema_id=#{ @view_cast.template_datum.s3_identifier }%26base_url=#{@site.cdn_endpoint}" %>", "col4");
          }
      },200)
  </script>
<% end %>