<div class="row">
    <div class="col-sm-6" style="padding: 0px; margin-left: auto; margin-right: auto;">
        <h1><span style="font-weight: 200;">Account Settings:</span> <%= best_in_place @account, :username, url: [@account] %></h1>
        <br/>
        <h3>Account Header Position Settings</h3>
            <%= simple_form_for [@account] do |f| %>
                <%= f.error_notification %>
                <%= f.input :header_url, as: :string, required: true, label: "URL" %>
                <%= f.input :header_background_color, input_html: {type: :color, style: "height: 40px;"}, required: true, label: "Background Color" %>
                <%= f.input :header_positioning, collection: [["Left", "left"], ["Center", "center"], ["Right", "right"]], label: "Position", include_blank: false %>
                <%= f.button :submit, "Update", class: "btn btn-light" %>
            <% end %>
        <hr/>
        <h3>Account Header Logo Settings</h3>
        <hr/>
        <% if @account.header_logo_id.present? %>
                <%= image_tag(@account.header_logo.original_image.image_url, class: "rounded", style: "width: 100px;") %>
                <br/>
                <%= simple_form_for [@account] do |f| %>
                  <%= f.error_notification %>
                  <%= f.input :header_logo_id, as: :hidden, input_html: {value: nil} %>
                  <%= f.button :submit, "Remove image", class: "btn btn-light" %>
                <% end %>
              <% else %>
                <%= image_tag("account.png", class: "rounded", style: "width: 100px;") %>
                <br/><br/>
                <%= simple_form_for [@account] do |f| %>
                  <%= f.error_notification %>

                  <%= f.fields_for :header_logo do |logo_image| %>
                    <%= logo_image.input :image, label: false %>
                    <%= logo_image.input :created_by, as: :hidden, input_html: {value: current_user.id} %>
                    <%= logo_image.input :updated_by, as: :hidden, input_html: {value: current_user.id} %>
                    <%= logo_image.input :account_id, as: :hidden, input_html: {value: @account.id}  %>
                    <%= logo_image.input :is_logo, as: :hidden, input_html: {value: true } %>
                  <% end %>
                  <%= f.button :submit, "Upload", class: "btn btn-light" %>
                <% end %>
              <% end %>
        <h3>Owners of this account</h3>
        <hr/>
        <div style="margin-left: 50px;">
            <div style="text-align: right;" class="hint">
              <span id='invite_members'><a href='#' data-toggle='modal' data-target='#platform_modal'>Invite people</a></span>
            </div>
            <table class="table table-hover">
                <tbody>
                    <% @permissions.each do |permission| %>
                        <tr>
                            <td style="width: 10%; border: 0px;"><img class="rounded" src=<%=avatar_url(permission.user.email)%>>
                            </td>
                            <td  style="border: 0px;">
                                <%= permission.user.name %>
                                <% if permission.status == "Deactivated" %>
                                    <i style="font-weight: 200; color: gray;">(Deactivated)</i>
                                <% end %>
                                <br/>
                                <% if permission.user.current_sign_in_at.present? %>
                                <div class="hint"><%= permission.user.email %></div>
                                <div class="hint">Last seen <%= time_ago_in_words(permission.user.current_sign_in_at) %> ago.</div>
                                <% end %>
                            </td>
                            <td  style="border: 0px;">
                                <% if current_user.id != permission.user_id and permission.status != "Deactivated" %>
                                <%= link_to "Change Role", change_owner_role_account_permission_path(@account, permission) %>
                                <% end %>
                            </td>
                        </tr>
                    <% end %>
                    <%= paginate @permissions %>
                </tbody>
            </table>
            <% if @pending_invites_count != 0 %>
                <br/>
                <h4>Pending Invites</h4>
                <table class="table">
                    <tbody>
                        <% @permission_invites.each do |permission_invite| %>
                            <tr>
                                <td style="width: 10%; border: 0px;"><img class="rounded" src=<%=avatar_url(permission_invite.email)%>>
                                </td>
                                <td style="border: 0px;">
                                    <%= permission_invite.email %>
                                    <div class="hint">Invited by <%= permission_invite.creator.name %> <%= time_ago_in_words (permission_invite.created_at) %>.</div>
                                </td>
                                <td style="border: 0px;"><%= link_to "Remove".html_safe, account_permission_invite_path(@account, permission_invite, redirect_url: edit_account_path(@account)), method: :delete, data: { confirm: 'Are you sure?' } %>
                                </td>
                            </tr>
                        <% end %>
                    </tbody>
                </table>
            <% end %>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal" id='platform_modal'>
  <div class="modal-dialog modal-sm" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <div class='modal-title'>Invite members</div>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="image content">
            <%= simple_form_for [@account, @permission_invite] do |f| %>
            <% if @permission_invite.errors.any? %>
            <div id="error_explanation" class="ui error message">
              <div class="header">
                <%= pluralize(@permission_invite.errors.count, "error") %> prohibited this permission_invite from being saved:
              </div>
              <% @permission_invite.errors.full_messages.each do |message| %>
              <p><%= message %></p>
              <% end %>
            </div>
            <% end %>
            <%= f.hidden_field :permissible_type, value: "Account" %>
            <%= f.hidden_field :permissible_id, value: @account.id %>
            <%= f.hidden_field :created_by, value: current_user.id %>
            <%= f.hidden_field :updated_by, value: current_user.id %>
            <%= f.input :email, id: :permission_invite_email, required: true, autofocus: true %>
            <%= f.hidden_field :redirect_url, value: edit_account_path(@account) %>
            <%= f.input :ref_role_slug, as: :hidden, input_html: {value: "owner"} %>
            <%= f.submit "Invite", class: "btn btn-light" %>
            <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

<% if @show_modal.present? and @show_modal %>
  <script type="text/javascript">
    $('#platform_modal').modal("show");
  </script>
<% end %>